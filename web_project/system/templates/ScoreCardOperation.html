<!DOCTYPE html>
<html>

<body>
  <h2>ScoreCard Library</h2>
  <div style="white-space: pre-line;" id='varlb'>
    <table border="1" style="border-collapse:collapse; width: 500px;" id="varlbtable">
      <tr>
        <th>index</th>
        <th>name</th>
        <th>id</th>
      </tr>
    </table>
    add new lib with name: <input type="text" id="varlbaddtext">
    <button type="button" id='varlbadd'>提交</button>
    delete lib with id: <input type="text" id="varlbdeltext">
    <button type="button" id='varlbdel'>提交</button>
    update lib with id and name: 
    <input type="text" id="varlbupdtext"> <input type="text" id="varlbupdnametext">
    <button type="button" id='varlbupd'>提交</button>
    <span>result: <span id="varlbresult"></span></span>
  </div>
  <br>

  <hr>
  <h2>ScoreCard Pool</h2>
  select library with id:
  <input type="text" id="varplselecttext" value="1">
  <button type="button" id='varplselect'>提交</button>
  <div>
    <table border="1" style="border-collapse:collapse; width: 500px;" id="varpltable">
      <tr>
        <th>index</th>
        <th>rule</th>
        <th>weight</th>
        <th>score</th>
        <th>id</th>
      </tr>
    </table>
    <br>
    add new variable with rule, weight, score:
    <input type="text" id="varpladdruletext" style="width:300px">
    <input type="text" id="varpladdweighttext" style="width:50px">
    <input type="text" id="varpladdscoretext" style="width:50px">

    <button type="button" id='varpladd'>提交</button>
    <br>
    delete variable with id: <input type="text" id="varpldeltext">
    <button type="button" id='varpldel'>提交</button>
    <br>
    update variable with id, rule, weight, score: 
    <input type="text" id="varplupdidtext" style="width:50px">
    <input type="text" id="varplupdruletext" style="width:300px">
    <input type="text" id="varplupdweighttext" style="width:50px">
    <input type="text" id="varplupdscoretext" style="width:50px">
    <button type="button" id='varplupd'>提交</button>
    <br>
    <span>result: <span id="varplresult"></span></span>
  </div>
  <br>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
    $(function () {
      $("#varlbadd").click(function () {
        var a = $("#varlbaddtext").val();
        $.post("{% url 'DBAccess' %}", { 'category': "SCLB", 'action': "ADD", 'name': a }, function (ret, status) {
          $("#varlbresult").text(ret);
          if (ret == 0) {
            getVarLib();
          }
        })
      });

      $("#varlbdel").click(function () {
        var a = $("#varlbdeltext").val();
        $.post("{% url 'DBAccess' %}", { 'category': "SCLB", 'action': "DEL", 'id': a }, function (ret, status) {
          $("#varlbresult").text(ret);
          if (ret == 0) {
            getVarLib();
          }
        })
      });

      $("#varlbupd").click(function () {
        var a = $("#varlbupdtext").val();
        var b = $("#varlbupdnametext").val();
        $.post("{% url 'DBAccess' %}", { 'category': "SCLB", 'action': "UPD", 'id': a, 'name':b }, function (ret, status) {
          $("#varlbresult").text(ret);
          if (ret == 0) {
            getVarLib();
          }
        })
      });

      $("#varplselect").click(function () {
        var a = $("#varplselecttext").val();
        getVarPool(a);
      });

      $("#varpladd").click(function () {
        var a = $("#varplselecttext").val();
        var b = $("#varpladdruletext").val();
        var c = $("#varpladdweighttext").val();
        var d = $("#varpladdscoretext").val();
        $.post("{% url 'DBAccess' %}", { 'category': "SCPL", 'action': "ADD", 'fk': a, 'rule': b, 'weight': c, 'score': d }, function (ret, status) {
          getVarPool(a);
          $("#varplresult").text(ret);
        })
      });

      $("#varpldel").click(function () {
        var a = $("#varplselecttext").val();
        var b = $("#varpldeltext").val();
        $.post("{% url 'DBAccess' %}", { 'category': "SCPL", 'action': "DEL", 'fk': a, 'id': b }, function (ret, status) {
          $("#varplresult").text(ret);
          if (ret == 0) {
            getVarPool(a);
          }
        })
      });

      $("#varplupd").click(function () {
        var a = $("#varplselecttext").val();
        var b = $("#varplupdidtext").val();
        var c = $("#varplupdruletext").val();
        var d = $("#varplupdweighttext").val();
        var e = $("#varplupdscoretext").val();
        $.post("{% url 'DBAccess' %}", { 'category': "SCPL", 'action': "UPD", 'fk': a, 'id': b, 'rule':c, 'weight':d, 'score':e }, function (ret, status) {
          $("#varplresult").text(ret);
          if (ret == 0) {
            getVarPool(a);
          }
        })
      });

      function getVarLib() {
        if (typeof getVarLib.listOfObjects == 'undefined') {
          getVarLib.listOfObjects = []
        }
        else {
          getVarLib.listOfObjects.forEach(function (x) {
            $(x).remove();
          });
        }
        $.get("{% url 'DBAccess' %}", { 'category': "SCLB" }, function (ret, status) {
          ret.forEach(function (value, index) {
            var txt1 = $("<td></td>").text(index);
            var txt2 = $("<td></td>").text(value[1]);
            var txt3 = $("<td></td>").text(value[0]);
            var td = $("<tr></tr>")
            td.append(txt1, txt2, txt3);
            $("#varlbtable").append(td);
            getVarLib.listOfObjects.push(td);
          });
        })
      }
      getVarLib();

      function getVarPool(id) {
        if (typeof getVarPool.listOfObjects == 'undefined') {
          getVarPool.listOfObjects = []
        }
        else {
          getVarPool.listOfObjects.forEach(function (x) {
            $(x).remove();
          });
        }
        $.get("{% url 'DBAccess' %}", { 'category': "SCPL", 'id': id }, function (ret, status) {
          ret.forEach(function (value, index) {
            var txt1 = $("<td></td>").text(index);
            var txt2 = $("<td></td>").text(value[1]);
            var txt3 = $("<td></td>").text(value[2]);
            var txt4 = $("<td></td>").text(value[3]);
            var txt5 = $("<td></td>").text(value[0]);
            var td = $("<tr></tr>");
            td.append(txt1, txt2, txt3, txt4,txt5);
            $("#varpltable").append(td);
            getVarPool.listOfObjects.push(td);
          });
        })
      }
      getVarPool(1);
    });
  </script>
</body>

</html>